<!DOCTYPE html>

<html>

<head>
	<title>Retour d'expérience</title>
	<style>
		* {
			box-sizing: border-box;
			font-family: Arial
		}

		h1 {
			text-align: center
		}

		input[type=text],
		input[type=date],
		input[type=time],
		select,
		textarea {
			width: 100%;
			padding: 12px;
			border: 1px solid #ccc;
			border-radius: 4px;
			resize: vertical;
		}

		label {
			padding: 12px 12px 12px 0;
			display: inline-block;
		}

		input[type=submit] {
			background-color: #4CAF50;
			color: white;
			padding: 12px 20px;
			border: none;
			border-radius: 4px;
			cursor: pointer;
			float: right;
		}

		input[type=submit]:hover {
			background-color: #45a049;
		}

		.slider {
			width: 100%;
			height: 30px;
			opacity: 0.7;
		}

		.container {
			border-radius: 5px;
			background-color: #f2f2f2;
			padding: 20px;
		}

		.col-25 {
			float: left;
			width: 25%;
			margin-top: 6px;
		}

		.col-75 {
			float: left;
			width: 75%;
			margin-top: 6px;
		}

		/* Clear floats after the columns */
		.row:after {
			content: "";
			display: table;
			clear: both;
		}

		/* Responsive layout - when the screen is less than 600px wide, make the two columns stack on top of each other instead of next to each other */
		@media screen and (max-width: 600px) {

			.col-25,
			.col-75,
			input[type=submit] {
				width: 100%;
				margin-top: 0;
			}
		}
	</style>
	<script src="script/filtered_database.js"></script>
	<script src="script/bdd.js"></script>
</head>

<body>
	<h1>Retour d'expérience</h1>

	<form id="formulaire" onsubmit="retrieveDataFromForm()">
		<div class="row">
			<div class="col-25">
				<label for="city_consult">Dans quelle ville avez-vous consulté ?</label>
			</div>
			<div class="col-75">
				<select id="city_consult" name="city_consult" onchange="establishmentUpdate()"></select>
			</div>
		</div>

		<script>
			//Create array of options to be added
			const valueList = ['Sélectionner une ville...', 'aix en provence', 'albi', 'alès', 'amboise', 'amilly', 'anduze', 'ares', 'arles', 'armentieres', 'arnas', 'aubagne', 'aubin', 'aulnay sous bois', 'auneau bleury st symphorie', 'bayonne', 'besançon', 'biarritz', 'blaye', 'bordeaux', 'bouguenais', 'boujan-sur-libron', 'boulogne billancourt', 'boulogne sur mer', 'bourg sur gironde', 'bourges', 'bourgoin', 'buzancais', 'béziers', 'cambrai', 'capdenac-gare', 'champagnole', 'chartres', 'chateauroux', 'châtellerault', 'clamart', 'clermont ferrand', "clermont-l'hérault", 'coueron', 'decazeville', 'denain', 'dijon', 'douai', 'draguignan', 'eaubonne', 'epernon', 'fontenay-le-comte', 'frontignan', 'gassin', 'gleize', 'hazebrouck', 'houdan', 'issoudun', 'ivry sur seine', "l'isle-sur-le-doubs", 'la chapelle sur erdre', 'la garde', 'la grand-combe', 'la madeleine', 'la montagne', 'la seyne sur mer', 'langeais', 'le mans', 'le port-marly', 'les abrets en dauphine', 'lesparre medoc', 'lodève', 'luce', 'lunel',
				'machecoul st meme', 'maintenon', 'mantes la jolie', 'marseille', 'millau', 'montfermeil', 'montpellier', 'morteau', 'mur-de-barrez', 'mérignac', 'nantes', 'nice', 'nimes', 'nogent le roi', 'oyonnax', 'paris', 'pau', 'pecquencourt', 'perigueux', 'pessac', 'poissy', 'pontarlier', 'rennes', 'reze', 'rignac', 'rodez', 'roeulx', 'romorantin lanthenay', 'saint christol les alès', 'saint jean de védas', 'saint-affrique', 'saint-ambroix', 'saint-beauzély', 'saint-gaudens', 'saint-sernin-sur-rance', 'salins-les-bains', 'saône', 'sin le noble', 'sommières', 'st aignan', 'st brevin les pins', 'st etienne', 'st gely du fesc', 'st herblain', 'st jean de luz', 'st philbert de grand lieu', 'ste luce sur loire', 'ste pazanne', 'steenvoorde', 'strasbourg', 'tarascon', 'toulon', 'toulouse', 'tours', 'valdahon', 'vandœuvre-lès-nancy', 'velizy villacoublay', 'versailles', 'vesoul', 'vierzon', 'villecomtal', 'villefranche-de-rouergue', 'villenave d ornon'];

			// Find the select list
			let cityConsultSelect = document.getElementById("city_consult");

			//Create and append the options
			for (let i = 0; i < valueList.length; i++) {
				let option = document.createElement("option");
				option.setAttribute("value", i);
				option.text = valueList[i];
				cityConsultSelect.appendChild(option);
			}
		</script>

		<div class="row">
			<div class="col-25">
				<label for="place_consult">Dans quel établissement ?</label>
			</div>
			<div class="col-75">
				<select id="place_consult" name="place_consult">
					<option value="no_value">Selectionner une ville ci-dessus</option>
				</select>
			</div>
		</div>

		<div class="row">
			<div class="col-25">
				<label for="arrival_date">Quel jour êtes vous venue ?</label>
			</div>
			<div class="col-75">
				<select id="arrival_date" name="arrival_date">
					<option value="monday">Lundi</option>
					<option value="tuesday">Mardi</option>
					<option value="wednesday">Mercredi</option>
					<option value="thursday">Jeudi</option>
					<option value="friday">Vendredi</option>
					<option value="saturday">Samedi</option>
					<option value="sunday">Dimanche</option>
				</select>
			</div>
		</div>

		<div class="row">
			<div class="col-25">
				<label for="arrival_hour">A quelle heure êtes-vous arrivé ?</label>
			</div>
			<div class="col-75">
				<input type="time" id="arrival_hour" name="arrival_hour" required>
			</div>
		</div>

		<div class="row">
			<div class="col-25">
				<label for="departed_hour">A quelle heure êtes-vous sortie ?</label>
			</div>
			<div class="col-75">
				<input type="time" id="departed_hour" name="departed_hour" required>
			</div>
		</div>

		<div class="row">
			<div class="col-25">
				<label for="motive">Quel est le motif de votre venue :</label>
			</div>
			<div class="col-75">
				<input class="checkbox" type="checkbox" id="motif_1" name="motif_1" value="depistage">
				<label for="motif_1"> Depistage du Covid-19</label>
				<br>
				<input class="checkbox" type="checkbox" id="motif_2" name="motif_2" value="vaccination">
				<label for="motif_2"> Vaccination du Covid-19</label>
			</div>
		</div>

			<div class="row">
				<div class="col-25">
					<label for="age">Quel est votre âge ?</label>
				</div>
				<div class="col-75">
					<select id="age" name="age">
						<option value="under_18">0 à 18</option>
						<option value="between_18_and_25">18 à 25</option>
						<option value="between_25_and_35">25 à 35</option>
						<option value="between_35_and_45">35 à 45</option>
						<option value="between_45_and_55">45 à 55</option>
						<option value="between_55_and_65">55 à 65</option>
						<option value="over_65">65 ou plus</option>
					</select>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-25">
				<label for="quality_control">Comment notez vous la prestation ?</label>
			</div>
			<div class="col-75">
				<input type="range" id="quality_control" class="slider" min="1" max="5" list="quality_control_values">

				<datalist id="quality_control_values">
					<option value="1"></option>
					<option value="2"></option>
					<option value="3"></option>
					<option value="4"></option>
					<option value="5"></option>
				</datalist>
			</div>
		</div>

		<input type="submit" value="Envoyer" onclick="checkInput()">
	</form>

	<script>
		function establishmentUpdate() {
			const centreList = [["Selectionner une ville ci-dessus"], ["CHI SITE D'AIX EN PROVENCE"], ['LBM ALTISBIO - ALBI'], ['LBM LABOSUD ALÈS', 'LBM LABOSUD ALES CARNOT', 'LBM LABOSUD ALES MARTYRS', 'LBM LABOSUD SAINT-CHRISTOL-LES-ALES'], ["CENTRE HOSPITALIER INTERCOMMUNAL d'AMBOISE -CHATEAU-RENAULT"], ['CH AGGLOMERATION MONTARGOISE'], ['LBM LABOSUD ANDUZE'], ['HOPITAL PRIVE WALLERSTEIN'], ['LBM LABOSUD ARLES TRINQUETAILLE'], ['LABORATOIRE SECONDAIRE DIAGNOVIE ARMEN', 'LABORATOIRE SECONDAIRE DIAGNOVIE SADI'], ['LBM NOVELAB ARNAS POLYCLINIQUE BEAUJOLAIS'], ['CENTRE HOSPITALIER GENERAL D AUBAGNE'], ['CSI UDSMA AUBIN CRANSAC'], ['CHI ROBERT BALLANGER'], ["LBM TONNELLERIE VALLEE DE L'EURE AUNEA"], ['LBM SEALAB-11 NOVEMBRE', 'CH DE LA COTE BASQUE - BAYONNE'], ['LBM CBM25 GAMBETTA', 'LBM CBM25 DE TERRE ROUGE', 'LBM CBM25 DES CHAPRAIS', 'LBM CBM25 DE MONTJOUX SAINT-CLAUDE', 'LBM CBM25 PLANOISE ILE-DE-FRANCE', 'LBM CBM25 DES TILLEROYES', 'LBM CBM25 DE PLANOISE POLYCLINIQUE'], ['LBM SEALAB-MARNE'], ['CH DE LA HAUTE GIRONDE', 'EHPAD - USLD CH SAINT-NICOLAS BLAYE'], ['LBM ACCOLAB SUD-OUEST - GRAND PARC', 'LBM ACCOLAB SUD-OUEST GALLIENI'], ['LBM BMPR - BOUGUENAIS'], ['LBM LABOSUD BOUJAN SUR LIBRON'], ['HU OUEST SITE AMBROISE PARE APHP'], ['CH BOULOGNE-SUR-MER'], ['EHPAD LES TERRASSES DE BELLEROQUE'], ['LBM BIO MEDI QUAL CENTRE BOURGES'], ['Site Pont Saint Michel'], ['LBM BIO MEDI QUAL CENTRE BUZANCAIS'], ['LBM LABOSUD BÉZIERS', 'LBM LABOSUD BEZIERS BIO2000'], ['CH CAMBRAI', 'EHPAD PAVILLON SAINT JULIEN', 'EHPAD GODELIEZ BOLVIN CH CAMBRAI', 'EHPAD RESIDENCE VANDERBURCH'], ['CSI UDSMA CAPDENAC'], ['MEDILYS - CHAMPAGNOLE'], ["LBM TONNELLERIE VALLEE DE L'EURE CHART"], ['LBM BIO MEDI QUAL CENTRE CHATEAUROUX'], ['Clinique de Châtellerault'], ['HIA PERCY', 'HIA PERCY'], ['CENTRE LUTTE CONTRE LE CANCER J.PERRIN'], ["LBM LABOSUD CLERMONT L'HERAULT"], ['LBM BIOLIANCE - Patients SANS SYMPTOMES pour dépistage préopératoire uniquement'], ['CSI UDSMA  DECAZEVILLE'], ['LABORATOIRE SECONDAIRE BIOTOP DENAIN'], ['CLCC GEORGES-FRANCOIS LECLERC'], ['LABORATOIRE SECONDAIRE BIOTOP DOUAI'], ['CSAPA LE MALMONT DRAGUIGNAN'], ['LBM BIOGROUP LBC SITE EAUBONNE'], ["LBM TONNELLERIE VALLEE DE L'EURE EPERN"], ['CH FONTENAY- LE- COMTE'], ['LBM LABOSUD FRONTIGNAN MISTRAL'], ["LBM CERBALLIANCE COTE D'AZUR PLATEAU GASSIN"], ['CH NORD OUEST - VILLEFRANCHE'], ['LABORATOIRE PRINCIPAL BIOTOP HZBK', 'LABORATOIRE SECONDAIRE BIOTOP RUE WARE'], ['LBM EUROFINS- BIOLAB SITE HOUDAN'], ['LBM BIO MEDI QUAL CENTRE ISSOUDUN'], ['HU PITIE SALPETRIERE- CHARLE FOIX APHP'], ["SANTÉ LABO - SITE L'ISLE/ DOUBS"], ['LBM BIOLIANCE - LA CHAPELLE SUR ERDRE - Patients SANS SYMPTOMES pour dépistage préopératoire uniquement'], ['EHPAD PUBLIC GEORGES CLEMENCEAU', 'CHITS HOPITAL GEORGES CLEMENCEAU', 'CHITS USLD HOPITAL GEORGES CLEMENCEAU'], ['LBM LABOSUD LA GRAND COMBE'], ['LABORATOIRE SECONDAIRE BIOTOP LA MADEL'], ['LBM BMPR - LA MONTAGNE'], ['EHPAD TOUSSAINT MERLE', 'CHITS USLD LA SEYNE SUR MER', 'CHITS CH GEORGE SAND'], ["LBM L'ABO+ LANGEAIS"], ['LBM LABORIZON MAINE ANJOU GAMBETTA LE'], ["LBM SELAS BIOSYNERGIE Laboratoire Clinique de l'Europe Port Marly"], ['LBM CERBALLIANCE RHONE ALPES LES ABRET'], ['CLINIQUE MUTUALISTE DU MEDOC'], ['LBM LABOSUD LODEVE'], ["LBM TONNELLERIE VALLEE DE L'EURE LUCE", 'LBM BIOLIANCE - Patients SANS SYMPTOMES pour dépistage préopératoire uniquement'], ['LBM LABOSUD LUNEL VAUBAN', 'LBM LABOSUD LUNEL VIA DOMITIA'], ['LBM BMPR - MACHECOUL ST MEME'], ["LBM TONNELLERIE VALLEE DE L'EURE MAINT"], ['CH FRANCOIS QUESNAY MANTES'], ['LBM ALPHABIO SITE MARSEILLE/GIORGETTI'], ['CSI UDSMA MILLAU'], ['GHI LE RAINCY MONTFERMEIL', 'CTRE D MOYEN ET LONG SEJOUR LES ORMES', 'EHPAD DU GHI LE RAINCY MONTFERMEIL', 'USLD CTRE GERIATRIQUE LES ORMES'], ['LBM LABOSUD MONTPELLIER GAROSUD', 'LBM LABOSUD MONTPELLIER CLINIQUE DU MILLENAIRE', 'LBM LABOSUD MONTPELLIER ALCO', 'LBM LABOSUD MONTPELLIER CLINIQUE CLEMENTVILLE', 'LBM LABOSUD MONTPELLIER CLINIQUE ST ROCH'], ['SANTÉ LABO - SITE MORTEAU'], ['CSI UDSMA MUR DE BARREZ'], ['Aéroport de Bordeaux Mérignac'], ['LBM BIOLIANCE - Patients SANS SYMPTOMES pour dépistage préopératoire uniquement'], ['LBM EUROFINS LABAZUR NICE SITE ST GEORGE'], ['LBM LABOSUD NIMES CARRE MEDICAL'], ["LBM TONNELLERIE VALLEE DE L'EURE NOGEN"], ['CH DU HAUT BUGEY - GEOVREISSET'], ['USLD EST PARISIEN SITE ROTHSCHILD APHP', 'HU PARIS CENTRE SITE HOTEL DIEU APHP', 'HU SAINT LOUIS SITE SAINT LOUIS APHP', 'HU EST PARISIEN SITE ST ANTOINE APHP', 'HU PITIE SALPETRIERE APHP', 'HU PARIS CENTRE SITE COCHIN APHP', 'HU NECKER ENFANTS MALADES APHP', 'HU PARIS NORD SITE BICHAT APHP', 'HU EST PARISIEN SITE TENON APHP', 'HU PARIS OUEST SITE G POMPIDOU APHP'], ['DRIVE BIOPYRENEES «\xa0HAUTE CAPACITÉ\xa0» ZÉNITH DE PAU', 'CENTRE HOSPITALIER DE PAU'], ['LABORATOIRE SECONDAIRE BIOTOP PECQUENC'], ['LBM NOVABIO-GUYNEMER', 'LBM NOVABIO-VESONE'], ['CLINIQUE MUTUALISTE DE PESSAC'], ['CDDC POISSY'], ['SANTÉ LABO - SITE PONTARLIER'], ['C.R.L.C.C. EUGENE MARQUIS'], ['LBM BIOLIANCE - Patients SANS SYMPTOMES pour dépistage préopératoire uniquement'], ['CSI UDSMA RIGNAC', 'Aéroport de Bordeaux Mérignac'], ['CSI UDSMA RODEZ'], ['LABORATOIRE SECONDAIRE BIOTOP ROEULX'], ['LBM BIO MEDI QUAL CENTRE ROMORANTIN'], ['LBM LABOSUD SAINT-CHRISTOL-LES-ALES'], ['LBM LABOSUD MONTPELLIER CLINIQUE ST JEAN'], ['CSI UDSMA St AFFRIQUE'], ['LBM LABOSUD SAINT-AMBROIX'], ['CSI UDSMA St BEAUZELY'], ['CH COMMINGES PYRENEES SITE PLANCARD'], ['CSI UDSMA St SERNIN SUR RANCE'], ['LBM CBM25 DES THERMES', 'LBM CBM25 DES THERMES'], ['LBM CBM25 DU PLATEAU', 'LBM CBM25 DU PLATEAU'], ['LABORATOIRE SECONDAIRE BIOTOP SIN LE N'], ['LBM LABOSUD SOMMIERES'], ['LBM BIO MEDI QUAL CENTRE SAINT AIGNAN'], ['LBM BMPR - ST BREVIN LES PINS'], ['LBM CERBALLIANCE LOIRE ST ETIENNE LA P'], ['LBM LABOSUD SAINT GELY DU FESC'], ['LBM BIOLIANCE - Patients SANS SYMPTOMES pour dépistage préopératoire uniquement', 'LBM BIOLIANCE - Patients SANS SYMPTOMES pour dépistage préopératoire uniquement'], ['LBM SEALAB-ELISSAGARAY'], ['LBM BIOLIANCE - SAINT-PHILBERT'], ['LBM BIOLIANCE - Patients SANS SYMPTOMES pour dépistage préopératoire uniquement'], ['LBM BMPR - STE PAZANNE'], ['LABORATOIRE SECONDAIRE BIOTOP STEENVOO'], ['LBM POTERIES  BIO67', 'LBM ASSIA PREMIUM BIO67'], ['LBM LABOSUD TARASCON'], ["LBM CERBALLIANCE COTE D'AZUR SITE TOUL - TOULON"], ['LBM BIOLAB AVENIR GIRONIS'], ["LBM L'ABO+ TOURS ORIGET", "LBM L'ABO+ TOURS RABELAIS"], ['SANTÉ LABO - SITE VALDAHON'], ["CHRU NANCY - HOPITAUX DE BRABOIS - HOPITAL D'ENFANTS"], ['LBM BIOSMOSE SITE VELIZY'], ['LBM SELAS BIOSYNERGIE SITE VERSAILLES - VERSAILLES'], ['SANTÉ LABO - SITE LECLERC - VESOUL'], ['LBM BIO MEDI QUAL CENTRE VIERZON'], ['CSI UDSMA VILLECOMTAL'], ['CSI UDSMA VILLEFRANCHE DE ROUERGUE'], ['HIA ROBERT PICQUE']]
			const iDBIndexList = [[0], [15], [163], [54, 59, 61, 63], [78], [105], [64], [42], [55], [116, 117], [133], [17], [14], [180], [37], [125, 128], [22, 23, 25, 26, 27, 29, 30], [124], [46, 47], [43, 44], [100], [76], [151], [122], [48], [84], [82], [87], [53, 72], [118, 119, 120, 121], [13], [83], [32], [88], [174], [154, 156], [123], [73], [94], [12], [107], [18], [111], [166], [159], [36], [173], [70], [164], [134], [109, 114], [161], [86], [152], [138], [99], [167, 171, 172], [62], [112], [101], [168, 169, 170], [81], [140], [157], [132], [49], [74], [33], [52, 69], [104], [34], [162], [16], [11], [176, 177, 178, 179], [51, 65, 66, 67, 68], [137], [4], [45], [97], [2], [57], [35], [1], [141, 142, 143, 144, 145, 146, 147, 148, 149, 150], [127, 129], [110], [19, 20], [50], [160], [135], [77], [92], [10, 45], [3], [108], [89], [63], [71], [7], [60], [9], [39], [8], [21, 31], [24, 28], [115], [58], [90], [102], [91], [75], [93, 98], [126], [95], [96], [103], [113], [130, 131], [56], [165], [38], [79, 80], [136], [106], [175], [158], [139], [85], [6], [5], [155]];
			const selectedCityID = document.getElementById("city_consult").value;
			let placeConsultSelect = document.getElementById("place_consult");
			placeConsultSelect.innerHTML = "";

			//Create and append the options
			for (let i = 0; i < centreList[selectedCityID].length; i++) {
				let option = document.createElement("option");
				option.setAttribute("value", iDBIndexList[selectedCityID][i]);
				option.text = centreList[selectedCityID][i];
				placeConsultSelect.appendChild(option);
			}
		}

		function checkInput() {
			let placeConsultValue = document.getElementById("place_consult").value;
			let arrivalHourValue = document.getElementById("arrival_hour").value;
			let departedHourValue = document.getElementById("departed_hour").value;

			if (parseInt(placeConsultValue) == 0) {
				console.log("Veuillez sélectionner une ville");
				return false;
			}

			if (arrivalHourValue > departedHourValue) {
				console.log("La date d'arrivée ne peut pas être postérieure à la date de départ")
				return false;
			}

			return true;
		}

		function retrieveDataFromForm() {
			if (!checkInput()) {
				console.log("données non valide, mise a jour non effectué")
				return;
			}

			let placeConsultValue = document.getElementById("place_consult").value;
			let arrivalDateValue = document.getElementById("arrival_date").value;
			let arrivalHourValue = document.getElementById("arrival_hour").value.substring(0, 2);
			let departedHourValue = document.getElementById("departed_hour").value.substring(0, 2);
			let ageValue = document.getElementById("age").value;
			let qualityControlValue = document.getElementById("quality_control").value;
			let depistageBooleanValue = document.getElementById("motif_1").checked;
			let vaccinationBooleanValue = document.getElementById("motif_2").checked;

			const ageDict = {
				"under_18": 0,
				"between_18_and_25": 1,
				"between_25_and_35": 2,
				"between_35_and_45": 3,
				"between_45_and_55": 4,
				"between_55_and_65": 5,
				"over_65": 6
			}
			const timetableDayDict = {
				"monday": 0,
				"tuesday": 1,
				"wednesday": 2,
				"thursday": 3,
				"friday": 4,
				"saturday": 5,
				"sunday": 6
			}
			const timetableHourDict = {
				"08": 0, "09": 1, "10": 2, "11": 3, "12": 4, "13": 5,
				"14": 6, "15": 7, "16": 8, "17": 9, "18": 10, "19": 11
			}

			var db, request;
			request = indexedDB.open("DepistageDatabase", 10);

			request.onsuccess = function (event) {
				db = request.result;
				let transaction = db.transaction("centres", "readwrite");
				transaction.objectStore("centres").openCursor(parseInt(placeConsultValue)).onsuccess = function (event) {
					var cursor, database_item;

					cursor = event.target.result;
					database_item = cursor.value;

					for (let it = arrivalHourValue; it < departedHourValue; it++) {
						database_item.heureAffuence[timetableDayDict[arrivalDateValue]][timetableHourDict[it]] = cursor.value.heureAffuence[timetableDayDict[arrivalDateValue]][timetableHourDict[it]] + 1
					}

					database_item.nbTest = ((depistageBooleanValue) ? cursor.value.nbTest + 1 : cursor.value.nbTest);
					database_item.nbVaccin = ((vaccinationBooleanValue) ? cursor.value.nbVaccin + 1 : cursor.value.nbVaccin);
					database_item.age[ageDict[ageValue]] = cursor.value.age[ageDict[ageValue]] + 1
					database_item.avis = (cursor.value.avis * (cursor.value.nbAvis / (cursor.value.nbAvis + 1)) + parseInt(qualityControlValue) * (1 / (cursor.value.nbAvis + 1))).toFixed(2);
					database_item.nbAvis = cursor.value.nbAvis + 1;

					cursor.update(database_item).onsuccess = function (event) {
						db.transaction("centres").objectStore("centres").get(parseInt(placeConsultValue)).onsuccess = function (event) {
							console.log("Cursor update onsuccess event:");
							console.log(event.target.result);
						};
					};
				};
			}

		}
		let arrival_date = document.getElementById("arrival_date");
		let today = new Date();
		let heures = today.getHours();
		if (heures < 10) {
			heures = "0" + heures;
		}
		let minutes = today.getMinutes();
		if (minutes < 10) {
			minutes = "0" + minutes;
		}
		switch (today.getDay()) {
			case 0:
				arrival_date.value = "sunday"; break;
			case 1:
				arrival_date.value = "monday"; break;
			case 2:
				arrival_date.value = "tuesday"; break;
			case 3:
				arrival_date.value = "wednesday"; break;
			case 4:
				arrival_date.value = "thursday"; break;
			case 5:
				arrival_date.value = "friday"; break;
			default:
				arrival_date.value = "saturday"; break;
		}
		document.getElementById("arrival_hour").value = heures + ":" + minutes;
		let URLsplit = window.location.href.split("?id=");
		if (URLsplit.length > 1) {
			let id = parseInt(URLsplit[1]);
			let connection = indexedDB.open("DepistageDatabase", 10);
			connection.onsuccess = (e) => {
				let mydb = connection.result;
				let mytransaction = mydb.transaction("centres", "readonly");
				let myobjectStore = mytransaction.objectStore("centres");
				let thingy = myobjectStore.get(id);
				thingy.onsuccess = () =>{
					el = thingy.result;
					document.getElementById("city_consult").value = valueList.indexOf(el.ville.toLowerCase());
					establishmentUpdate();	
				}
				
			}
		</script>
    </body>
</html>
